<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ì‹œí™”ì¡°ë ¥ ìŠ¤ë§ˆíŠ¸ ê´€ë¦¬ ì‹œìŠ¤í…œ</title>
    <style>
        body { background: #121212; color: white; font-family: 'Malgun Gothic', sans-serif; text-align: center; margin: 0; padding: 20px; }
        .dashboard-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; max-width: 1000px; margin: 0 auto; }
        .card { background: #1e1e1e; border: 1px solid #333; padding: 20px; border-radius: 12px; transition: 0.3s; }
        .card:hover { border-color: #00e5ff; }
        .label { font-size: 0.9em; color: #aaa; margin-bottom: 10px; }
        .val { font-size: 2.2em; font-weight: bold; color: #00e5ff; }
        .unit { font-size: 0.4em; color: #777; margin-left: 5px; }
        
        /* ë‚™ì°¨ ê°•ì¡° ìŠ¤íƒ€ì¼ */
        .highlight { background: #263238; border: 2px solid #00e5ff; }
        .highlight .val { color: #ffff00; }
        
        /* ìƒíƒœ ë°” */
        .status-banner { grid-column: span 3; padding: 15px; border-radius: 8px; margin-top: 10px; font-weight: bold; font-size: 1.2em; }
        .bg-normal { background: #004d40; color: #00e676; }
        .bg-warn { background: #b71c1c; color: #ff5252; animation: pulse 1s infinite; }
        
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.7; } 100% { opacity: 1; } }
    </style>
</head>
<body>
    <h1>ğŸŒŠ ì¡°ë ¥ë°œì „ ì‹¤ì‹œê°„ ìˆ˜ìœ„ ë° ë‚™ì°¨ ëª¨ë‹ˆí„°ë§</h1>
    
    <div class="dashboard-grid">
        <div class="card">
            <div class="label">í•´ìˆ˜ìœ„ (Sea Level)</div>
            <div id="sea-val" class="val">0.00<span class="unit">m</span></div>
        </div>
        <div class="card">
            <div class="label">í˜¸ìˆ˜ìœ„ (Lake Level)</div>
            <div id="lake-val" class="val">0.00<span class="unit">m</span></div>
        </div>
        <div class="card highlight">
            <div class="label">ìµœì¢… ìœ íš¨ ë‚™ì°¨ (Head)</div>
            <div id="head-val" class="val">0.00<span class="unit">m</span></div>
        </div>

        <div class="card">
            <div class="label">ì“°ë ˆê¸° ìœ ì… ê°•ë„</div>
            <div id="waste-val" class="val">0</div>
        </div>
        <div class="card" style="grid-column: span 2;">
            <div class="label">ëˆ„ì  ë°œì „ ì†ì‹¤ì•¡</div>
            <div id="loss-val" class="val" style="color: #ffea00;">0<span class="unit">ì›</span></div>
        </div>

        <div id="status-banner" class="status-banner bg-normal">
            ì‹œìŠ¤í…œ ì •ìƒ ìš´ì „ ì¤‘
        </div>
    </div>

<script>
    function update() {
        fetch('/data')
            .then(res => {
                if (!res.ok) throw new Error('ë„¤íŠ¸ì›Œí¬ ì‘ë‹µ ì—†ìŒ');
                return res.json();
            })
            .then(data => {
                // ë°ì´í„°ê°€ ì˜¤ëŠ”ì§€ ì½˜ì†”ì— ë¨¼ì € ì°ì–´ë´…ë‹ˆë‹¤ (ë””ë²„ê¹…ìš©)
                console.log("ë°›ì€ ë°ì´í„°:", data);

                // IDê°€ ì¼ì¹˜í•˜ëŠ”ì§€ í™•ì¸í•˜ë©° í™”ë©´ ê°±ì‹ 
                document.getElementById('sea-val').innerHTML = data.sea.toFixed(2) + '<span class="unit">m</span>';
                document.getElementById('lake-val').innerHTML = data.lake.toFixed(2) + '<span class="unit">m</span>';
                document.getElementById('head-val').innerHTML = data.head.toFixed(3) + '<span class="unit">m</span>';
                document.getElementById('waste-val').innerText = data.waste;
                document.getElementById('loss-val').innerHTML = data.loss_cum.toLocaleString() + '<span class="unit">ì›</span>';

                // ìƒíƒœ ë°°ë„ˆ ì—…ë°ì´íŠ¸
                const banner = document.getElementById('status-banner');
                if (data.waste > 700) {
                    banner.innerText = "ğŸš¨ ê²½ê³ : ë¶€ìœ ë¬¼ ëŒ€ëŸ‰ ìœ ì… - ìˆ˜ê±° ê¶Œì¥";
                    banner.className = "status-banner bg-warn";
                } else {
                    banner.innerText = "ì‹œìŠ¤í…œ ì •ìƒ ìš´ì „ ì¤‘";
                    banner.className = "status-banner bg-normal";
                }
            })
            .catch(error => {
                console.error("ìë°”ìŠ¤í¬ë¦½íŠ¸ ì—ëŸ¬ ë°œìƒ:", error);
            });
    }

    // 0.5ì´ˆë§ˆë‹¤ ì—…ë°ì´íŠ¸ ì‹¤í–‰
    setInterval(update, 500);
</script>
</body>
</html>